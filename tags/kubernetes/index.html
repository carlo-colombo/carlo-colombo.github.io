<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<title>
  
    Tag: kubernetes
  
</title>

<meta property="og:type" content="website">
<meta property="og:title" content="litblog">
<meta property="og:url" content="https://carlo-colombo.github.io/tags/kubernetes/index.html">
<meta property="og:site_name" content="litblog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Carlo Colombo">
<meta name="twitter:card" content="summary">


  <link rel="alternative" href="/atom.xml" title="litblog" type="application/atom+xml">



  <link rel="icon" href="/favicon.png">



<link rel="stylesheet" href="/perfect-scrollbar/css/perfect-scrollbar.min.css">


<link rel="stylesheet" href="/styles/main.css">



<meta name="generator" content="Hexo 5.2.0"></head>
<body
  
  >
  <div class="mobile-header">
  <button class="sidebar-toggle" type="button">
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
  </button>
  <a class="title" href="/">litblog</a>
</div>

  <div class="main-container">
    <div class="sidebar">
  <div class="header">
    <h1 class="title"><a href="/">litblog</a></h1>
    
    <div class="info">
      <div class="content">
        
        
          <div class="author">Carlo Colombo</div>
        
      </div>
      
        <div class="avatar">
          
            <img src="https://cn.gravatar.com/avatar/56559186a8e4bb75389af7d997c2f41c?s=200">
          
        </div>
      
    </div>
  </div>
  <div class="body">
    
      
        <ul class="nav">
          
            
              <li class="tag-list-container">
                <a href="javascript:;">Tag</a>
                <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/conform/" rel="tag">conform</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elixir/" rel="tag">elixir</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/exrm/" rel="tag">exrm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gcp/" rel="tag">gcp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/google-analytics/" rel="tag">google analytics</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/google-cloud-functions/" rel="tag">google cloud functions</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k3s/" rel="tag">k3s</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kubernetes/" rel="tag">kubernetes</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/macro/" rel="tag">macro</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/serverless/" rel="tag">serverless</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/telegram/" rel="tag">telegram</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tiddlywiki/" rel="tag">tiddlywiki</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vps/" rel="tag">vps</a><span class="tag-list-count">1</span></li></ul>
              </li>
            
          
        </ul>
      
        <ul class="nav">
          
            
              <li>
                <a href="/" title="Homepage" external="false">Homepage</a>
              </li>
            
          
            
              <li>
                <a href="/about" title="About" external="false">About</a>
              </li>
            
          
            
              <li>
                <a href="/archives" title="By Year" external="false">By Year</a>
              </li>
            
          
        </ul>
      
        <ul class="nav">
          
            
              <li>
                <a href="https://github.com/carlo-colombo" title="Github" target="_blank" rel="noopener">Github</a>
              </li>
            
          
            
              <li>
                <a href="/atom.xml" title="RSS" external="false">RSS</a>
              </li>
            
          
        </ul>
      
    
  </div>
</div>

    <div class="main-content">
      
        <div style="max-width: 1000px">
      
          <h1>kubernetes</h1>


  
  
    <div class="post-list">
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2020/12/02/Deploy-TiddlyWiki-on-Kubernetes/" >
  Deploy TiddlyWiki on Kubernetes
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2020/12/02/Deploy-TiddlyWiki-on-Kubernetes/"><span class="article-date">
  2020-12-02
</span>
</a>
        

        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/k3s/" rel="tag">k3s</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kubernetes/" rel="tag">kubernetes</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tiddlywiki/" rel="tag">tiddlywiki</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <h2 id="Discovery-of-TiddlyWiki"><a href="#Discovery-of-TiddlyWiki" class="headerlink" title="Discovery of TiddlyWiki"></a>Discovery of TiddlyWiki</h2><p>I discovered <a target="_blank" rel="noopener" href="https://tiddlywiki.com/">TiddlyWiki</a> reading the <a target="_blank" rel="noopener" href="https://joearms.github.io/">blog of the late Joe Armstrong</a> (of Erlang fame). After reading a post about Erlang and Elixir I started looking into other posts and I found his introduction to TiddlyWiki. The author presented how was using the wiki as his blog and as todo list systems.</p>
<p>I periodically start to investigate, use for a few weeks, and then abandon todo list systems. I went through at least Trello, Google Tasks, Google Keep, textfiles, command line tools, and probably some mobile app. I did not experiment with these systems for a while so I decided to give it a go. As bonus point it can be used personal knowledge base and it seemed infinitly configurable and extendable with JavaScript. A few minutes and I downloaded the one html file that is all that is needed to start use TiddlyWiki.</p>
<h2 id="My-first-setup"><a href="#My-first-setup" class="headerlink" title="My first setup"></a>My first setup</h2><p>The original way to use TiddlyWiki is to have a single file that can be resaved when new Tiddlers are added to the wiki. This was not suitable to me as I was planning to access to the wiki from at least: my phone, my laptop and the my work computer. I felt that if I have to manually export the TiddlyWiki then move to another device I would have it abondoned in no time as I would quickly forget, then I would have out of sync wikis and then stopped using it.</p>
<p>TiddlyWiki propose a number of ways to save and share TiddlyWiki, I went with storing it on <a target="_blank" rel="noopener" href="https://tiddlywiki.com/static/TiddlyDrive%2520Add-on%2520for%2520Google%2520Drive%2520by%2520Joshua%2520Stubbs.html">Google Drive</a>. It worked and it served me well, but a few times I found my self with out of sync wikis and I have to retrieve the Tiddlers I was interested in from Google Drive revisions. I was able to consume the wiki from both my phone and computers but it has some limitation for concurrent editing, involutary as if it was open on the phone and tried to edit on the computer and it got messy. At the end the backend is a single file that is overriden when the wiki is saved.</p>
<p>In this period I was mostly using it for TODO management using Tiddlers from Joe Armstrong, organizing my job search, and as groceries shopping list. At the same time I started to have an itch to interact programmatically with the wiki(adding, listing, …).</p>
<h2 id="Entering-k3s"><a href="#Entering-k3s" class="headerlink" title="Entering k3s"></a>Entering k3s</h2><p>One of the <a target="_blank" rel="noopener" href="https://tiddlywiki.com/#GettingStarted">many option</a> to deploy TiddlyWiki is to run it on <a target="_blank" rel="noopener" href="https://tiddlywiki.com/#Installing%20TiddlyWiki%20on%20Node.js">Node.js</a> that also provide HTTP api to interact with the wiki. After some experimentation on the local machine I was set to deploy it somewhere more persistent and make it available from everywhere.</p>
<p><a target="_blank" rel="noopener" href="https://k3s.io/">k3s</a> is a lightweight kubernetes distribuition from Rancher that deploys as a single binary and is focused on IoT and edge computing but I think is very suitable to an hobbyst like me that worked on Kubernetes and use something confortable without all the complication of deploying a more featured distribuition. I find it so confortable that I have a k3s node running on my work laptop hosting TiddlyWiki but it could be the argument of another post.</p>
<p>I already maintain a k3s kubernetes cluster (of 1 node) on Scaleway with some Telegram bots and static websites so I started to conjure some yaml to deploy it on the cluster.</p>
<p>After experimenting creating my own container image I find out that <code>elasticdog/tiddlywiki</code> exists and it is maintened so I settled with that. The Node.js TiddlyWiki distribution supports authentication and some basic authorization roles (reader and writer), it required me some fiddling with the parameters but at the end I was able to define multiple users (admin, carlo, and bot) with no anonymous access. The cluster is already set for https using certmanager and Let’s Encrypt, so I plugged in it with an Ingress controller provided by Traefik and I was able to have it available on the internet reasonably secure with encryption and authentication.</p>
<p>Tiddlywiki need to be pointed to a <code>wikifolder</code> that will contain tiddlers and a single configuration file (<code>tiddlywiki.info</code>). The proper way to do it would be to run <code>tiddlywiki &lt;wikifolder&gt; --init</code> in an init container, make it skip the creation if the file already exist or removing the init container in a following deployment. What I did was more messy as I exec’d in the Tiddlywiki container and then copy the <code>.info</code> file created on my machine in the remote volume.</p>
<p>The full configuration is available on <a target="_blank" rel="noopener" href="https://github.com/carlo-colombo/deployment/blob/master/spec/tiddlywiki.yml">carlo-colombo/tiddlywiki</a>, I am using <a target="_blank" rel="noopener" href="https://carvel.dev/">Carvel</a> (former k14s) tools ytt, kapp, and kbld to build images, inject secrets and deploy to the cluster (check <a target="_blank" rel="noopener" href="https://github.com/carlo-colombo/deployment/blob/master/deploy.sh"><code>deploy.sh</code></a>).</p>
<h2 id="Backup"><a href="#Backup" class="headerlink" title="Backup"></a>Backup</h2><p>I am using the very good <a target="_blank" rel="noopener" href="https://restic.net/">restic</a> to backup my tiddlers to a remote storage, Scaleway Object Storage (that is S3 compatible). I backup <a target="_blank" rel="noopener" href="https://github.com/carlo-colombo/deployment/blob/master/spec/backup.yml">every 10 minutes</a> because I would be pissed if I was writing something long and lose more than 10 minutes of work, anyway restic is going to only store the diff if any and some metadata so I am not worried about my monthly invoice.</p>
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>The setup is quite convuluted and some level of overkill but I feel more confortable using kubernetes and a full declararive deployment than doing it manually with just docker or docker-compose on a server. At the end kubernetes was in my day to day job for a couple of years and I picked a few things along the way. </p>
<p>Having TiddlyWiki deployed and accessible from anywhere with http available to interact opens up nice possibilities to interact that I am exploring and having fun with it.</p>

        
      </div>
    </div>

  
    </div>
  






          <div class="main-footer">
  
    Carlo Colombo © 2017
  
</div>

      
        </div>
      
    </div>
  </div>
  
<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>


  
<link rel="stylesheet" href="/PhotoSwipe/photoswipe.css">

  
<link rel="stylesheet" href="/PhotoSwipe/default-skin/default-skin.css">


  <!-- Root element of PhotoSwipe. Must have class pswp. -->
  <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
             It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

      <!-- Container that holds slides.
                PhotoSwipe keeps only 3 of them in the DOM to save memory.
                Don't modify these 3 pswp__item elements, data is added later on. -->
      <div class="pswp__container">
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
      </div>

      <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
      <div class="pswp__ui pswp__ui--hidden">

        <div class="pswp__top-bar">

          <!--  Controls are self-explanatory. Order can be changed. -->

          <div class="pswp__counter"></div>

          <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

          <button class="pswp__button pswp__button--share" title="Share"></button>

          <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

          <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

          <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
          <!-- element will get class pswp__preloader--active when preloader is running -->
          <div class="pswp__preloader">
            <div class="pswp__preloader__icn">
              <div class="pswp__preloader__cut">
                <div class="pswp__preloader__donut"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
          <div class="pswp__share-tooltip"></div>
        </div>

        <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>

        <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>

        <div class="pswp__caption">
          <div class="pswp__caption__center"></div>
        </div>
      </div>
    </div>
  </div>

  
<script src="/PhotoSwipe/photoswipe.js"></script>

  
<script src="/PhotoSwipe/photoswipe-ui-default.js"></script>




<script src="/perfect-scrollbar/js/min/perfect-scrollbar.min.js"></script>


<script src="/scripts/main.js"></script>


</body>
</html>
